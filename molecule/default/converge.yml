---
- name: Converge
  hosts: all
  vars:
    yubikey_config_login: true
    yubikey_api_id: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          33613930323337636335323934383733373464376461653036396432613762346439376138313262
          3133303837353762333333383466656332353265343737630a646463623665313534353238313832
          38646136343635316164623337373434366263613930643930383939323339346565373633613364
          3562663237663733610a306236303035396532356131656539303436383866373265393163666663
          3666
    yubikey_api_key: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          31396163323963313332316335376235333337376264636238623166353966333263356334363263
          6431633635646234356337633161343831303636626266640a306137626437623361313239333438
          65336538663034633166373836316231653937363835363235356464383036366438323161313037
          6237333366323339380a626262653435313130316664616631663937633438333230333864356465
          39663563636637353039663964613538666561613836333165313632303135363963
    yubikey_users:
      - name: hurricane
        authorized_yubikeys:
          - ccccccfcjbff
          - ccccccevhffu
          - ccccccelhfrc
          - ccccccevhfdf
        challenges:
          - id: 3826880
            challenge:  !vault |
              $ANSIBLE_VAULT;1.1;AES256
              37636436336335666336366237353739646530313662653436356531336235323231346261303839
              3363363464663134333061393465613530353737333030380a613066393631376539306239303534
              61393639373364333563363466653361373164356433323435323265376233663931306139626431
              6666333862303439610a353163646530633630356335646233346332616132656131663238336234
              31613237346239636364346231326537613834353334663431613365373838386366653031373363
              38373835353363343962333830303362326437323962333063366339356232353965396634383838
              65333762373739646137623466383961656562383763616231366663663335386661623233323338
              33653136343566356234653165353936363336306336366264653633326565396665336638333765
              37666138353530636239356466346263613332653039376335636135663636306664633664396430
              62623537306638333163646666343461663066666463313139643936316261643464626135626364
              63643863653636316331333638373935656430343663613633326362643865326335623265313965
              39653434393939346663333634336139346331663132623961396336366631633663326137323438
              37393563393764633331356664343538383033323666613861363232383130643735663864343137
              32376666356438303039336263326563343865323938376464356533336337386461326533656566
              34376234663866663561383662306330646232616361346330663765313236356231333932383235
              66633036306462386534643632656435373934393438653966306638623530343463316530636635
              3263
  tasks:
    - name: Add sshd privilege seperation dir
      file:
        path: /run/sshd
        state: directory

    - name: Add user
      user:
        name: hurricane
        append: yes
        shell: /bin/bash
        create_home: yes
        password: '$6$Dz7DRuGe$gJekeA67Ezp0raeRoS3AL6In2MpQ6z/tiY4w6b/xoyk0X8f/yNsOYNsBnVqnzlP643lGW6tvVRXvaJrmvqGR/0'

    - name: Run ansible-pam_yubikey role
      include_role:
        name: ansible-pam_yubikey
